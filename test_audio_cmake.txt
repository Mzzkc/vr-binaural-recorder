# Simple CMake to test audio engine compilation
cmake_minimum_required(VERSION 3.16)
project(TestAudioEngine)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Find packages
find_package(Threads REQUIRED)

# External dependencies
include(FetchContent)

# PortAudio
FetchContent_Declare(
    portaudio
    GIT_REPOSITORY https://github.com/PortAudio/portaudio.git
    GIT_TAG v19.7.0
)
set(PA_BUILD_SHARED OFF CACHE BOOL "Build shared library" FORCE)

# spdlog
FetchContent_Declare(
    spdlog
    GIT_REPOSITORY https://github.com/gabime/spdlog.git
    GIT_TAG v1.11.0
)

# jsoncpp
FetchContent_Declare(
    jsoncpp
    GIT_REPOSITORY https://github.com/open-source-parsers/jsoncpp.git
    GIT_TAG 1.9.5
)

FetchContent_MakeAvailable(portaudio spdlog jsoncpp)

# Source files (without VR dependencies)
set(SOURCES
    test_audio_engine.cpp
    src/audio_engine.cpp
    src/hrtf_processor.cpp
    src/logger.cpp
)

add_executable(test_audio_engine ${SOURCES})

target_include_directories(test_audio_engine PRIVATE
    ${CMAKE_CURRENT_SOURCE_DIR}
)

target_link_libraries(test_audio_engine PRIVATE
    Threads::Threads
    portaudio_static
    spdlog::spdlog
    jsoncpp_lib
)

# Platform-specific libraries
if(WIN32)
    target_link_libraries(test_audio_engine PRIVATE winmm ws2_32)
elseif(UNIX AND NOT APPLE)
    target_link_libraries(test_audio_engine PRIVATE m)
endif()